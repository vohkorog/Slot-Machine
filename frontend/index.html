<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–û–¥–Ω–æ—Ä—É–∫–∏–π –±–∞–Ω–¥–∏—Ç (Python edition)</title>
    <!-- –ú–µ–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ CSS -->
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="machine">
        <div class="reels">
            <div class="reel" id="reel1">?</div>
            <div class="reel" id="reel2">?</div>
            <div class="reel" id="reel3">?</div>
        </div>
        <button id="lever">üí™ –î–µ—Ä–Ω—É—Ç—å —Ä—ã—á–∞–≥</button>
        <p id="message">–ù–∞–∂–º–∏ –Ω–∞ —Ä—ã—á–∞–≥!</p>
    </div>

    <script>
        const reel1 = document.getElementById('reel1');
        const reel2 = document.getElementById('reel2');
        const reel3 = document.getElementById('reel3');
        const leverButton = document.getElementById('lever');
        const messageDisplay = document.getElementById('message');

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
        function startSpinAnimation() {
            reel1.classList.add('reel-spin');
            reel2.classList.add('reel-spin');
            reel3.classList.add('reel-spin');
            messageDisplay.textContent = 'üé∞ –°–≤—è–∑—ã–≤–∞–µ–º—Å—è —Å Python... üé∞';
            leverButton.disabled = true;
        }

        function stopSpinAnimation() {
            reel1.classList.remove('reel-spin');
            reel2.classList.remove('reel-spin');
            reel3.classList.remove('reel-spin');
            leverButton.disabled = false;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–∑–æ–≤–∞ Python-—Å–µ—Ä–≤–µ—Ä–∞
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–∑–æ–≤–∞ Python-—Å–µ—Ä–≤–µ—Ä–∞
        async function callPythonSpin() {
            startSpinAnimation();
            
            try {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º POST-–∑–∞–ø—Ä–æ—Å –Ω–∞ –Ω–∞—à FastAPI-—Å–µ—Ä–≤–µ—Ä
                const response = await fetch('http://localhost:8000/api/spin', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    // –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Å—Ç–∞–≤–∫—É, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                    body: JSON.stringify({}) 
                });
                
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                }
                
                const data = await response.json();
                
                if (data.success) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –¥–∞–Ω–Ω—ã–º–∏ –æ—Ç Python
                    reel1.textContent = data.reels[0];
                    reel2.textContent = data.reels[1];
                    reel3.textContent = data.reels[2];
                    messageDisplay.textContent = data.message;
                } else {
                    throw new Error(data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                messageDisplay.textContent = 'üòµ –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å Python!';
                reel1.textContent = '?';
                reel2.textContent = '?';
                reel3.textContent = '?';
            } finally {
                stopSpinAnimation();
            }
        }

        // –í–µ—à–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É
        leverButton.addEventListener('click', callPythonSpin);
    </script>
</body>
</html>