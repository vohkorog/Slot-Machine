<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Однорукий бандит</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="machine">
        <div class="reels">
            <div class="reel" id="reel1">?</div>
            <div class="reel" id="reel2">?</div>
            <div class="reel" id="reel3">?</div>
        </div>
        <button id="lever">Дернуть рычаг</button>
    </div>

    <script>
        const reel1 = document.getElementById('reel1');
        const reel2 = document.getElementById('reel2');
        const reel3 = document.getElementById('reel3');
        const leverButton = document.getElementById('lever');
        const messageDisplay = document.getElementById('message');

        function startSpinAnimation() {
            reel1.classList.add('reel-spin');
            reel2.classList.add('reel-spin');
            reel3.classList.add('reel-spin');
            leverButton.disabled = true;
        }

        function stopSpinAnimation() {
            reel1.classList.remove('reel-spin');
            reel2.classList.remove('reel-spin');
            reel3.classList.remove('reel-spin');
            leverButton.disabled = false;
        }

        async function callPythonSpin() {
            startSpinAnimation();
            
            try {
                const response = await fetch('http://localhost:8000/api/spin', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({}) 
                });
                
                
                const data = await response.json();
                
                if (data.success) {
                    reel1.textContent = data.reels[0];
                    reel2.textContent = data.reels[1];
                    reel3.textContent = data.reels[2];
                    messageDisplay.textContent = data.message;
                }                 
            } finally {
                stopSpinAnimation();
            }
        }

        leverButton.addEventListener('click', callPythonSpin);
    </script>
</body>
</html>